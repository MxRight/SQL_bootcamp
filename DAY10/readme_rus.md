 

## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 00 ‚Äî –ê—É–¥–∏—Ç –≤—Ö–æ–¥—è—â–∏—Ö INSERT

| –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 00: –ê—É–¥–∏—Ç –≤—Ö–æ–¥—è—â–∏—Ö INSERT |                  |
| ------------------------------------ | ---------------- |
| –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–¥–∞—á–∏                 | ex00             |
| –§–∞–π–ª—ã –¥–ª—è —Å–¥–∞—á–∏                      | `day09_ex00.sql` |
| **–†–∞–∑—Ä–µ—à–µ–Ω–æ**                        |                  |
| –Ø–∑—ã–∫                                 | SQL, DDL, DML    |

–ú—ã —Ö–æ—Ç–∏–º –±—ã—Ç—å —Å–∏–ª—å–Ω–µ–µ –≤ —Ä–∞–±–æ—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏ –∏ –Ω–µ —Ç–µ—Ä—è—Ç—å –Ω–∏ –æ–¥–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è. –î–∞–≤–∞–π—Ç–µ —Ä–µ–∞–ª–∏–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∞—É–¥–∏—Ç–∞ –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö `INSERT`.  

–°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É **person_audit** —Å —Ç–æ–π –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, —á—Ç–æ –∏ —Ç–∞–±–ª–∏—Ü–∞ **person**, –Ω–æ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏. –°–º–æ—Ç—Ä–∏ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ –Ω–∏–∂–µ:

| –ö–æ–ª–æ–Ω–∫–∞    | –¢–∏–ø                      | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                                                                         |
| ---------- | ------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| created    | timestamp with time zone | –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é = `current_timestamp`. NOT NULL                                                                             |
| type_event | char(1)                  | –∑–Ω–∞—á–µ–Ω–∏—è: I (insert), D (delete), U (update). –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é = ‚ÄòI‚Äô. NOT NULL. –î–æ–±–∞–≤–∏—Ç—å check constraint `ch_type_event` –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è ‚ÄòI‚Äô, ‚ÄòU‚Äô, ‚ÄòD‚Äô. |
| row_id     | bigint                   | –∫–æ–ø–∏—è person.id. NOT NULL                                                                                                                        |
| name       | varchar                  | –∫–æ–ø–∏—è person.name (–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)                                                                                                              |
| age        | integer                  | –∫–æ–ø–∏—è person.age (–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)                                                                                                               |
| gender     | varchar                  | –∫–æ–ø–∏—è person.gender (–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)                                                                                                            |
| address    | varchar                  | –∫–æ–ø–∏—è person.address (–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)                                                                                                           |

üëâ –†–µ–∞–ª–∏–∑—É–π **—Ç—Ä–∏–≥–≥–µ—Ä–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é** `fnc_trg_person_insert_audit`, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ –ª–æ–≤–∏—Ç—å `INSERT`-—Ç—Ä–∞—Ñ–∏–∫ –∏ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ `person_audit`.

üí° –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: PostgreSQL-—Ç—Ä–∏–≥–≥–µ—Ä = **2 –æ–±—ä–µ–∫—Ç–∞**:  

1. Trigger Function  
2. –°–∞–º Trigger  

–°–æ–∑–¥–∞–π —Ç—Ä–∏–≥–≥–µ—Ä **trg_person_insert_audit**:  

- `FOR EACH ROW`;  
- `AFTER INSERT`;  
- –≤—ã–∑—ã–≤–∞–µ—Ç `fnc_trg_person_insert_audit`.  

–ü—Ä–æ–≤–µ—Ä—å —á–µ—Ä–µ–∑ `INSERT`:  

```sql
INSERT INTO person(id, name, age, gender, address)
VALUES (10,'Damir', 22, 'male', 'Irkutsk');
```

---

## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 01 ‚Äî –ê—É–¥–∏—Ç –≤—Ö–æ–¥—è—â–∏—Ö UPDATE

| –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 01: –ê—É–¥–∏—Ç –≤—Ö–æ–¥—è—â–∏—Ö UPDATE |                  |
| ------------------------------------ | ---------------- |
| –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–¥–∞—á–∏                 | ex01             |
| –§–∞–π–ª—ã –¥–ª—è —Å–¥–∞—á–∏                      | `day09_ex01.sql` |
| **–†–∞–∑—Ä–µ—à–µ–Ω–æ**                        |                  |
| –Ø–∑—ã–∫                                 | SQL, DDL, DML    |

–¢–µ–ø–µ—Ä—å –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∞—É–¥–∏—Ç –¥–ª—è `UPDATE`. –°–æ–∑–¥–∞–π—Ç–µ —Ç—Ä–∏–≥–≥–µ—Ä `trg_person_update_audit` –∏ —Ç—Ä–∏–≥–≥–µ—Ä–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `fnc_trg_person_update_audit`, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å **—Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (OLD)** –≤—Å–µ—Ö –∫–æ–ª–æ–Ω–æ–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö.

–ü—Ä–æ–≤–µ—Ä—å —á–µ—Ä–µ–∑:  

```sql
UPDATE person SET name = 'Bulat' WHERE id = 10;
UPDATE person SET name = 'Damir' WHERE id = 10;
```

---

## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 02 ‚Äî –ê—É–¥–∏—Ç –≤—Ö–æ–¥—è—â–∏—Ö DELETE

| –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 02: –ê—É–¥–∏—Ç –≤—Ö–æ–¥—è—â–∏—Ö DELETE |                  |
| ------------------------------------ | ---------------- |
| –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–¥–∞—á–∏                 | ex02             |
| –§–∞–π–ª—ã –¥–ª—è —Å–¥–∞—á–∏                      | `day09_ex02.sql` |
| **–†–∞–∑—Ä–µ—à–µ–Ω–æ**                        |                  |
| –Ø–∑—ã–∫                                 | SQL, DDL, DML    |

–î–∞–ª—å—à–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º `DELETE`. –¢–æ –µ—Å—Ç—å ‚Äî –∫–æ–ø–∏—Ä—É–µ–º **—Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (OLD)** —É–¥–∞–ª—è–µ–º—ã—Ö —Å—Ç—Ä–æ–∫. –°–æ–∑–¥–∞–π—Ç–µ:  

- —Ç—Ä–∏–≥–≥–µ—Ä `trg_person_delete_audit`  
- —Ñ—É–Ω–∫—Ü–∏—é `fnc_trg_person_delete_audit`  

–ü—Ä–æ–≤–µ—Ä—å —á–µ—Ä–µ–∑:  

```sql
DELETE FROM person WHERE id = 10;
```

---

## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 03 ‚Äî –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∞—É–¥–∏—Ç

| –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 03: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∞—É–¥–∏—Ç |                  |
| ---------------------------------- | ---------------- |
| –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–¥–∞—á–∏               | ex03             |
| –§–∞–π–ª—ã –¥–ª—è —Å–¥–∞—á–∏                    | `day09_ex03.sql` |
| **–†–∞–∑—Ä–µ—à–µ–Ω–æ**                      | SQL, DDL, DML    |

–°–µ–π—á–∞—Å —É –Ω–∞—Å **—Ç—Ä–∏ —Ä–∞–∑–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–∞** –Ω–∞ –æ–¥–Ω—É —Ç–∞–±–ª–∏—Ü—É. –î–∞–≤–∞–π—Ç–µ –æ–±—ä–µ–¥–∏–Ω–∏–º –ª–æ–≥–∏–∫—É –≤ –æ–¥–∏–Ω:  

- —Ç—Ä–∏–≥–≥–µ—Ä **trg_person_audit**  
- —Ñ—É–Ω–∫—Ü–∏—è **fnc_trg_person_audit**  

–û–¥–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ —Å–æ–±—ã—Ç–∏—è `INSERT`, `UPDATE`, `DELETE`. –í–Ω—É—Ç—Ä–∏ –∫–æ–¥–∞ —Å–¥–µ–ª–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ `IF-ELSE` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–±—ã—Ç–∏—è.  

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:  

- —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ 3 —Ç—Ä–∏–≥–≥–µ—Ä–∞,  
- —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ 3 —Ñ—É–Ω–∫—Ü–∏–∏,  
- –æ—á–∏—Å—Ç–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É `person_audit` (`TRUNCATE` –∏–ª–∏ `DELETE`).  

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º:  

```sql
INSERT INTO person(id, name, age, gender, address)  VALUES (10,'Damir', 22, 'male', 'Irkutsk');
UPDATE person SET name = 'Bulat' WHERE id = 10;
UPDATE person SET name = 'Damir' WHERE id = 10;
DELETE FROM person WHERE id = 10;
```

---

## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 04 ‚Äî –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ VS –§—É–Ω–∫—Ü–∏—è

| –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 04 |                  |
| ------------- | ---------------- |
| –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è    | ex04             |
| –§–∞–π–ª—ã         | `day09_ex04.sql` |
| **–†–∞–∑—Ä–µ—à–µ–Ω–æ** | SQL, DDL, DML    |

–†–∞–Ω–µ–µ –º—ã –¥–µ–ª–∞–ª–∏ –¥–≤–∞ **VIEW** –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã `person` –ø–æ –ø–æ–ª—É. –¢–µ–ø–µ—Ä—å —Å–¥–µ–ª–∞–µ–º SQL-—Ñ—É–Ω–∫—Ü–∏–∏:  

- `fnc_persons_female()` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∂–µ–Ω—â–∏–Ω  
- `fnc_persons_male()` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º—É–∂—á–∏–Ω  

–í—ã–∑–æ–≤:  

```sql
SELECT * FROM fnc_persons_male();
SELECT * FROM fnc_persons_female();
```

---

## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 05 ‚Äî –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –±–∞–∑—ã

| –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 05 |                  |
| ------------- | ---------------- |
| –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è    | ex05             |
| –§–∞–π–ª—ã         | `day09_ex05.sql` |
| **–†–∞–∑—Ä–µ—à–µ–Ω–æ** | SQL, DDL, DML    |

–§—É–Ω–∫—Ü–∏–∏ –∏–∑ –∑–∞–¥–∞–Ω–∏—è 04 —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–Ω—ã–µ. –£–¥–∞–ª–∏—Ç–µ –∏—Ö –∏ —Å–¥–µ–ª–∞–π—Ç–µ **–æ–¥–Ω—É —Ñ—É–Ω–∫—Ü–∏—é** `fnc_persons(pgender text DEFAULT 'female')`.  

–í—ã–∑–æ–≤:  

```sql
SELECT * FROM fnc_persons(pgender := 'male');
SELECT * FROM fnc_persons();
```

---

## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 06 ‚Äî –§—É–Ω–∫—Ü–∏—è-–æ–±–µ—Ä—Ç–∫–∞

| –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 06 |                  |
| ------------- | ---------------- |
| –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è    | ex06             |
| –§–∞–π–ª—ã         | `day09_ex06.sql` |
| **–†–∞–∑—Ä–µ—à–µ–Ω–æ** | SQL, DDL, DML    |

–¢–µ–ø–µ—Ä—å –ø–æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è —Å **PL/pgSQL**.  

–°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `fnc_person_visits_and_eats_on_date(pperson text DEFAULT 'Dmitriy', pprice int DEFAULT 500, pdate date DEFAULT '2022-01-08')`.  

–û–Ω–∞ –¥–æ–ª–∂–Ω–∞:  

- –≤—ã–≤–æ–¥–∏—Ç—å –∏–º–µ–Ω–∞ –ø–∏—Ü—Ü–µ—Ä–∏–π,  
- –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Å–µ—Ç–∏–ª `pperson`,  
- –∏ –≥–¥–µ –º–æ–∂–Ω–æ –±—ã–ª–æ –∫—É–ø–∏—Ç—å –ø–∏—Ü—Ü—É –¥–µ—à–µ–≤–ª–µ `pprice`,  
- –∏–º–µ–Ω–Ω–æ –≤ –¥–∞—Ç—É `pdate`.  

–í—ã–∑–æ–≤:  

```sql
SELECT * FROM fnc_person_visits_and_eats_on_date(pprice := 800);
SELECT * FROM fnc_person_visits_and_eats_on_date(pperson := 'Anna', pprice := 1300, pdate := '2022-01-01');
```

---

## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 07 ‚Äî –ü–æ–∏—Å–∫ –º–∏–Ω–∏–º—É–º–∞

| –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 07 |                  |
| ------------- | ---------------- |
| –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è    | ex07             |
| –§–∞–π–ª—ã         | `day09_ex07.sql` |
| **–†–∞–∑—Ä–µ—à–µ–Ω–æ** | SQL, DDL, DML    |

–ù–∞–ø–∏—à–∏—Ç–µ SQL- –∏–ª–∏ PL/pgSQL-—Ñ—É–Ω–∫—Ü–∏—é `func_minimum(arr NUMERIC[])`, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –º–∞—Å—Å–∏–≤ —á–∏—Å–µ–ª –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.  

–í—ã–∑–æ–≤:  

```sql
SELECT func_minimum(VARIADIC arr => ARRAY[10.0, -1.0, 5.0, 4.4]);
```

---

## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 08 ‚Äî –ê–ª–≥–æ—Ä–∏—Ç–º –§–∏–±–æ–Ω–∞—á—á–∏ –≤ —Ñ—É–Ω–∫—Ü–∏–∏

| –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 08 |                  |
| ------------- | ---------------- |
| –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è    | ex08             |
| –§–∞–π–ª—ã         | `day09_ex08.sql` |
| **–†–∞–∑—Ä–µ—à–µ–Ω–æ** | SQL, DDL, DML    |

–ù–∞–ø–∏—à–∏—Ç–µ SQL- –∏–ª–∏ PL/pgSQL-—Ñ—É–Ω–∫—Ü–∏—é `fnc_fibonacci(pstop int DEFAULT 10)`, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **—Ç–∞–±–ª–∏—Ü—É —á–∏—Å–µ–ª –§–∏–±–æ–Ω–∞—á—á–∏, –º–µ–Ω—å—à–∏—Ö —á–µ–º `pstop`**.  

–í—ã–∑–æ–≤:  

```sql
SELECT * FROM fnc_fibonacci(100);
SELECT * FROM fnc_fibonacci();
```
