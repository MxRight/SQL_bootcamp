

## Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ 00 â€” Ð”Ð°Ð²Ð°Ð¹Ñ‚Ðµ ÑÐ¾Ð·Ð´Ð°Ð´Ð¸Ð¼ Ð¸Ð½Ð´ÐµÐºÑÑ‹ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð²Ð½ÐµÑˆÐ½ÐµÐ³Ð¾ ÐºÐ»ÑŽÑ‡Ð°

| Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ 00: Ð”Ð°Ð²Ð°Ð¹Ñ‚Ðµ ÑÐ¾Ð·Ð´Ð°Ð´Ð¸Ð¼ Ð¸Ð½Ð´ÐµÐºÑÑ‹ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð²Ð½ÐµÑˆÐ½ÐµÐ³Ð¾ ÐºÐ»ÑŽÑ‡Ð° |                  |
| ------------------------------------------------------------------ | ---------------- |
| Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ Ð´Ð»Ñ ÑÐ´Ð°Ñ‡Ð¸                                               | ex00             |
| Ð¤Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ ÑÐ´Ð°Ñ‡Ð¸                                                    | `day05_ex00.sql` |
| **Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¾**                                                      |                  |
| Ð¯Ð·Ñ‹Ðº                                                               | ANSI SQL         |

Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ BTree-Ð¸Ð½Ð´ÐµÐºÑ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð²Ð½ÐµÑˆÐ½ÐµÐ³Ð¾ ÐºÐ»ÑŽÑ‡Ð° Ð² Ð½Ð°ÑˆÐµÐ¹ Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ….  

Ð¨Ð°Ð±Ð»Ð¾Ð½ Ð½Ð°Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ñ Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ñƒ:  
**`idx_{table_name}_{column_name}`**

ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð¸Ð¼Ñ BTree-Ð¸Ð½Ð´ÐµÐºÑÐ° Ð´Ð»Ñ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ¸ `pizzeria_id` Ð² Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ðµ `menu` Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ **`idx_menu_pizzeria_id`**.  

---

## Ð“Ð»Ð°Ð²Ð° V

## Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ 01 â€” ÐšÐ°Ðº Ð´Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ð¸Ð½Ð´ÐµÐºÑ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚?

| Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ 01: ÐšÐ°Ðº Ð´Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ð¸Ð½Ð´ÐµÐºÑ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚? |                  |
| ------------------------------------------------- | ---------------- |
| Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ Ð´Ð»Ñ ÑÐ´Ð°Ñ‡Ð¸                              | ex01             |
| Ð¤Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ ÑÐ´Ð°Ñ‡Ð¸                                   | `day05_ex01.sql` |
| **Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¾**                                     |                  |
| Ð¯Ð·Ñ‹Ðº                                              | ANSI SQL         |

ÐŸÐµÑ€ÐµÐ´ Ñ‚ÐµÐ¼ ÐºÐ°Ðº Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ, Ð½Ð°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ SQL-Ð·Ð°Ð¿Ñ€Ð¾Ñ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð¿Ð¸Ñ†Ñ†Ñ‹ Ð¸ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ Ð¿Ð¸Ñ†Ñ†ÐµÑ€Ð¸Ð¹.  
Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð½Ð¾ Ñ‚Ð°ÐºÐ¸Ð¼ (ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð½Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ):  

| pizza_name   | pizzeria_name |
| ------------ | ------------- |
| cheese pizza | Pizza Hut     |
| ...          | ...           |

Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð´Ð¾ÐºÐ°Ð¶ÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð¸Ð½Ð´ÐµÐºÑ Ð·Ð°Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð» Ð´Ð»Ñ Ð²Ð°ÑˆÐµÐ³Ð¾ SQL-Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°.  

ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð´Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð° â€” ÑÑ‚Ð¾ Ð²Ñ‹Ð²Ð¾Ð´ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ **`EXPLAIN ANALYZE`**.  

ÐžÐ±Ñ€Ð°Ð·ÐµÑ† Ð²Ñ‹Ð²Ð¾Ð´Ð°:  

```
...
->  Index Scan using idx_menu_pizzeria_id on menu m  (...)
...
```

**ÐŸÐ¾Ð´ÑÐºÐ°Ð·ÐºÐ°**: Ð¿Ð¾Ð´ÑƒÐ¼Ð°Ð¹Ñ‚Ðµ, Ð¿Ð¾Ñ‡ÐµÐ¼Ñƒ Ð²Ð°ÑˆÐ¸ Ð¸Ð½Ð´ÐµÐºÑÑ‹ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ, Ð¸ Ñ‡Ñ‚Ð¾ Ð½ÑƒÐ¶Ð½Ð¾ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¸Ñ… Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ. ðŸ˜‰  

---

## Ð“Ð»Ð°Ð²Ð° VI

## Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ 02 â€” Ð¤Ð¾Ñ€Ð¼ÑƒÐ»Ð° Ð² Ð¸Ð½Ð´ÐµÐºÑÐµ. Ð­Ñ‚Ð¾ Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ð¾?

| Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ 02: Ð¤Ð¾Ñ€Ð¼ÑƒÐ»Ð° Ð² Ð¸Ð½Ð´ÐµÐºÑÐµ. Ð­Ñ‚Ð¾ Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ð¾? |                  |
| ------------------------------------------------ | ---------------- |
| Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ Ð´Ð»Ñ ÑÐ´Ð°Ñ‡Ð¸                             | ex02             |
| Ð¤Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ ÑÐ´Ð°Ñ‡Ð¸                                  | `day05_ex02.sql` |
| **Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¾**                                    |                  |
| Ð¯Ð·Ñ‹Ðº                                             | ANSI SQL         |

Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ BTree-Ð¸Ð½Ð´ÐµÐºÑ `idx_person_name` Ð½Ð° ÐºÐ¾Ð»Ð¾Ð½ÐºÑƒ `name` Ð² Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ðµ `person`.  
Ð˜Ð½Ð´ÐµÐºÑ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð¸Ð¼ÐµÐ½Ð° Ð»ÑŽÐ´ÐµÐ¹ **Ð² Ð²ÐµÑ€Ñ…Ð½ÐµÐ¼ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ðµ**.  

ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶Ð¸Ñ‚Ðµ Ð»ÑŽÐ±Ð¾Ð¹ SQL Ñ Ð´Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð¾Ð¼ (`EXPLAIN ANALYZE`), Ñ‡Ñ‚Ð¾ Ð¸Ð½Ð´ÐµÐºÑ `idx_person_name` Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚.  

---

## Ð“Ð»Ð°Ð²Ð° VII

## Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ 03 â€” ÐœÑƒÐ»ÑŒÑ‚Ð¸ÐºÐ¾Ð»Ð¾Ð½Ð¾Ñ‡Ð½Ñ‹Ð¹ Ð¸Ð½Ð´ÐµÐºÑ Ð´Ð»Ñ Ð½Ð°ÑˆÐ¸Ñ… Ñ†ÐµÐ»ÐµÐ¹

| Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ 03: ÐœÑƒÐ»ÑŒÑ‚Ð¸ÐºÐ¾Ð»Ð¾Ð½Ð¾Ñ‡Ð½Ñ‹Ð¹ Ð¸Ð½Ð´ÐµÐºÑ Ð´Ð»Ñ Ð½Ð°ÑˆÐ¸Ñ… Ñ†ÐµÐ»ÐµÐ¹ |                  |
| ------------------------------------------------------ | ---------------- |
| Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ Ð´Ð»Ñ ÑÐ´Ð°Ñ‡Ð¸                                   | ex03             |
| Ð¤Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ ÑÐ´Ð°Ñ‡Ð¸                                        | `day05_ex03.sql` |
| **Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¾**                                          |                  |
| Ð¯Ð·Ñ‹Ðº                                                   | ANSI SQL         |

Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð¼Ð½Ð¾Ð³Ð¾ÐºÐ¾Ð»Ð¾Ð½Ð¾Ñ‡Ð½Ñ‹Ð¹ BTree-Ð¸Ð½Ð´ÐµÐºÑ `idx_person_order_multi` Ð´Ð»Ñ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ SQL-Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°:

```sql
SELECT person_id, menu_id, order_date
FROM person_order
WHERE person_id = 8 AND menu_id = 19;
```

ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° `EXPLAIN ANALYZE` Ð´Ð¾Ð»Ð¶Ð½Ð° Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð½Ð¾ Ñ‚Ð°ÐºÐ¾Ð¹ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½ (Ð¾Ð±Ñ€Ð°Ñ‚Ð¸Ñ‚Ðµ Ð²Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ: **Index Only Scan**!):

```
Index Only Scan using idx_person_order_multi on person_order ...
```

ÐŸÑ€Ð¸Ð»Ð¾Ð¶Ð¸Ñ‚Ðµ Ð»ÑŽÐ±Ð¾Ð¹ SQL Ñ Ð´Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð¾Ð¼ (`EXPLAIN ANALYZE`), Ñ‡Ñ‚Ð¾ **`idx_person_order_multi`** Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚.  

---

## Ð“Ð»Ð°Ð²Ð° VIII

## Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ 04 â€” Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð´Ð»Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…

| Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ 04: Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð´Ð»Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… |                  |
| -------------------------------------- | ---------------- |
| Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ Ð´Ð»Ñ ÑÐ´Ð°Ñ‡Ð¸                   | ex04             |
| Ð¤Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ ÑÐ´Ð°Ñ‡Ð¸                        | `day05_ex04.sql` |
| **Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¾**                          |                  |
| Ð¯Ð·Ñ‹Ðº                                   | ANSI SQL         |

Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ BTree-Ð¸Ð½Ð´ÐµÐºÑ `idx_menu_unique` Ð½Ð° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ `menu` Ð´Ð»Ñ ÐºÐ¾Ð»Ð¾Ð½Ð¾Ðº **`pizzeria_id`** Ð¸ **`pizza_name`**.  

ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶Ð¸Ñ‚Ðµ Ð»ÑŽÐ±Ð¾Ð¹ SQL Ñ Ð´Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð¾Ð¼ (`EXPLAIN ANALYZE`), Ñ‡Ñ‚Ð¾ Ð¸Ð½Ð´ÐµÐºÑ `idx_menu_unique` Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚.  

---

## Ð“Ð»Ð°Ð²Ð° IX

## Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ 05 â€” Ð§Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð°Ñ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð´Ð»Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…

| Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ 05: Ð§Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð°Ñ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð´Ð»Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… |                  |
| ------------------------------------------------ | ---------------- |
| Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ Ð´Ð»Ñ ÑÐ´Ð°Ñ‡Ð¸                             | ex05             |
| Ð¤Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ ÑÐ´Ð°Ñ‡Ð¸                                  | `day05_ex05.sql` |
| **Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¾**                                    |                  |
| Ð¯Ð·Ñ‹Ðº                                             | ANSI SQL         |

Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ **Ñ‡Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹** BTree-Ð¸Ð½Ð´ÐµÐºÑ `idx_person_order_order_date` Ð½Ð° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ `person_order` Ð¿Ð¾ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ°Ð¼ `person_id` Ð¸ `menu_id`, Ñ ÑƒÑ‡ÐµÑ‚Ð¾Ð¼ Ñ‡Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾Ð¹ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ð¿Ð¾ ÐºÐ¾Ð»Ð¾Ð½ÐºÐµ `order_date` Ð´Ð»Ñ Ð´Ð°Ñ‚Ñ‹ `'2022-01-01'`.  

ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° `EXPLAIN ANALYZE` Ð´Ð¾Ð»Ð¶Ð½Ð° Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð½Ð¾ Ñ‚Ð°ÐºÐ¾Ð¹ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½:

```
Index Only Scan using idx_person_order_order_date on person_order â€¦
```

---

## Ð“Ð»Ð°Ð²Ð° X

## Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ 06 â€” Ð£Ð»ÑƒÑ‡ÑˆÐ¸Ð¼ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ

| Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ 06: Ð£Ð»ÑƒÑ‡ÑˆÐ¸Ð¼ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ |                  |
| ----------------------------------------- | ---------------- |
| Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ Ð´Ð»Ñ ÑÐ´Ð°Ñ‡Ð¸                      | ex06             |
| Ð¤Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ ÑÐ´Ð°Ñ‡Ð¸                           | `day05_ex06.sql` |
| **Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¾**                             |                  |
| Ð¯Ð·Ñ‹Ðº                                      | ANSI SQL         |

Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ð¼ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ SQL **Ñ Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñ‹** (Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼ ÐµÐ³Ð¾ Ð»Ð¾Ð³Ð¸ÐºÑƒ):

```sql
SELECT
    m.pizza_name AS pizza_name,
    max(rating) OVER (PARTITION BY rating ORDER BY rating ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS k
FROM  menu m
INNER JOIN pizzeria pz ON m.pizzeria_id = pz.id
ORDER BY 1,2;
```

Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ BTree-Ð¸Ð½Ð´ÐµÐºÑ `idx_1`, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑƒÐ»ÑƒÑ‡ÑˆÐ¸Ñ‚ÑŒ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÑƒ **Execution Time** Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ SQL.  

ÐŸÑ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ Ð´Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð¾ (`EXPLAIN ANALYZE`), Ñ‡Ñ‚Ð¾ SQL Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÑÑ‚Ð°Ð» Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð±Ñ‹ÑÑ‚Ñ€ÐµÐµ.  

**ÐŸÐ¾Ð´ÑÐºÐ°Ð·ÐºÐ°**: ÑÑ‚Ð¾ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ñ…Ð¾Ð¶Ðµ Ð½Ð° Â«Ð¿Ð¾Ð¸ÑÐº Ð³Ñ€ÑƒÐ±Ð¾Ð¹ ÑÐ¸Ð»Ð¾Ð¹Â» Ð¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‰ÐµÐ³Ð¾ cover-Ð¸Ð½Ð´ÐµÐºÑÐ°. ÐŸÐ¾ÑÑ‚Ð¾Ð¼Ñƒ Ð¿ÐµÑ€ÐµÐ´ Ð½Ð¾Ð²Ñ‹Ð¼ Ñ‚ÐµÑÑ‚Ð¾Ð¼ ÑƒÐ´Ð°Ð»ÑÐ¹Ñ‚Ðµ `idx_1`.  

---

ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¼Ð¾ÐµÐ³Ð¾ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ:

**Ð”Ð¾**:

```
Sort  (cost=26.08..26.13 rows=19 width=53) (actual time=0.247..0.254 rows=19 loops=1)
"  Sort Key: m.pizza_name, (max(pz.rating) OVER (?))"
Sort Method: quicksort  Memory: 26kB
->  WindowAgg  (cost=25.30..25.68 rows=19 width=53) (actual time=0.110..0.182 rows=19 loops=1)
        ->  Sort  (cost=25.30..25.35 rows=19 width=21) (actual time=0.088..0.096 rows=19 loops=1)
            Sort Key: pz.rating
            Sort Method: quicksort  Memory: 26kB
            ->  Merge Join  (cost=0.27..24.90 rows=19 width=21) (actual time=0.026..0.060 rows=19 loops=1)
                    Merge Cond: (m.pizzeria_id = pz.id)
                    ->  Index Only Scan using idx_menu_unique on menu m  (cost=0.14..12.42 rows=19 width=22) (actual time=0.013..0.029 rows=19 loops=1)
                        Heap Fetches: 19
                    ->  Index Scan using pizzeria_pkey on pizzeria pz  (cost=0.13..12.22 rows=6 width=15) (actual time=0.005..0.008 rows=6 loops=1)
Planning Time: 0.711 ms
Execution Time: 0.338 ms
```

**ÐŸÐ¾ÑÐ»Ðµ**:

```
Sort  (cost=26.28..26.33 rows=19 width=53) (actual time=0.144..0.148 rows=19 loops=1)
"  Sort Key: m.pizza_name, (max(pz.rating) OVER (?))"
Sort Method: quicksort  Memory: 26kB
->  WindowAgg  (cost=0.27..25.88 rows=19 width=53) (actual time=0.049..0.107 rows=19 loops=1)
        ->  Nested Loop  (cost=0.27..25.54 rows=19 width=21) (actual time=0.022..0.058 rows=19 loops=1)
            ->  Index Scan using idx_1 on â€¦
            ->  Index Only Scan using idx_menu_unique on menu m  (cost=0.14..2.19 rows=3 width=22) (actual time=0.004..0.005 rows=3 loops=6)
â€¦
Planning Time: 0.338 ms
Execution Time: 0.203 ms
```
